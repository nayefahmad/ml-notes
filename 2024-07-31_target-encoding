{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "a1bf7153",
   "metadata": {
    "papermill": {
     "duration": 0.008292,
     "end_time": "2024-10-24T22:31:17.288342",
     "exception": false,
     "start_time": "2024-10-24T22:31:17.280050",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Introduction #\n",
    "\n",
    "Most of the techniques we've seen in this course have been for numerical features. The technique we'll look at in this lesson, *target encoding*, is instead meant for categorical features. It's a method of encoding categories as numbers, like one-hot or label encoding, with the difference that it also uses the *target* to create the encoding. This makes it what we call a **supervised** feature engineering technique."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "940a5c83",
   "metadata": {
    "_kg_hide-input": true,
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:17.305765Z",
     "iopub.status.busy": "2024-10-24T22:31:17.305219Z",
     "iopub.status.idle": "2024-10-24T22:31:18.483634Z",
     "shell.execute_reply": "2024-10-24T22:31:18.482123Z"
    },
    "papermill": {
     "duration": 1.190822,
     "end_time": "2024-10-24T22:31:18.487025",
     "exception": false,
     "start_time": "2024-10-24T22:31:17.296203",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "\n",
    "autos = pd.read_csv(\"../input/fe-course-data/autos.csv\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "5dd5e330",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.503334Z",
     "iopub.status.busy": "2024-10-24T22:31:18.502827Z",
     "iopub.status.idle": "2024-10-24T22:31:18.553569Z",
     "shell.execute_reply": "2024-10-24T22:31:18.552033Z"
    },
    "papermill": {
     "duration": 0.062743,
     "end_time": "2024-10-24T22:31:18.556938",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.494195",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>symboling</th>\n",
       "      <th>make</th>\n",
       "      <th>fuel_type</th>\n",
       "      <th>aspiration</th>\n",
       "      <th>num_of_doors</th>\n",
       "      <th>body_style</th>\n",
       "      <th>drive_wheels</th>\n",
       "      <th>engine_location</th>\n",
       "      <th>wheel_base</th>\n",
       "      <th>length</th>\n",
       "      <th>...</th>\n",
       "      <th>engine_size</th>\n",
       "      <th>fuel_system</th>\n",
       "      <th>bore</th>\n",
       "      <th>stroke</th>\n",
       "      <th>compression_ratio</th>\n",
       "      <th>horsepower</th>\n",
       "      <th>peak_rpm</th>\n",
       "      <th>city_mpg</th>\n",
       "      <th>highway_mpg</th>\n",
       "      <th>price</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>3</td>\n",
       "      <td>alfa-romero</td>\n",
       "      <td>gas</td>\n",
       "      <td>std</td>\n",
       "      <td>2</td>\n",
       "      <td>convertible</td>\n",
       "      <td>rwd</td>\n",
       "      <td>front</td>\n",
       "      <td>88.6</td>\n",
       "      <td>168.8</td>\n",
       "      <td>...</td>\n",
       "      <td>130</td>\n",
       "      <td>mpfi</td>\n",
       "      <td>3.47</td>\n",
       "      <td>2.68</td>\n",
       "      <td>9</td>\n",
       "      <td>111</td>\n",
       "      <td>5000</td>\n",
       "      <td>21</td>\n",
       "      <td>27</td>\n",
       "      <td>13495</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3</td>\n",
       "      <td>alfa-romero</td>\n",
       "      <td>gas</td>\n",
       "      <td>std</td>\n",
       "      <td>2</td>\n",
       "      <td>convertible</td>\n",
       "      <td>rwd</td>\n",
       "      <td>front</td>\n",
       "      <td>88.6</td>\n",
       "      <td>168.8</td>\n",
       "      <td>...</td>\n",
       "      <td>130</td>\n",
       "      <td>mpfi</td>\n",
       "      <td>3.47</td>\n",
       "      <td>2.68</td>\n",
       "      <td>9</td>\n",
       "      <td>111</td>\n",
       "      <td>5000</td>\n",
       "      <td>21</td>\n",
       "      <td>27</td>\n",
       "      <td>16500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>alfa-romero</td>\n",
       "      <td>gas</td>\n",
       "      <td>std</td>\n",
       "      <td>2</td>\n",
       "      <td>hatchback</td>\n",
       "      <td>rwd</td>\n",
       "      <td>front</td>\n",
       "      <td>94.5</td>\n",
       "      <td>171.2</td>\n",
       "      <td>...</td>\n",
       "      <td>152</td>\n",
       "      <td>mpfi</td>\n",
       "      <td>2.68</td>\n",
       "      <td>3.47</td>\n",
       "      <td>9</td>\n",
       "      <td>154</td>\n",
       "      <td>5000</td>\n",
       "      <td>19</td>\n",
       "      <td>26</td>\n",
       "      <td>16500</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2</td>\n",
       "      <td>audi</td>\n",
       "      <td>gas</td>\n",
       "      <td>std</td>\n",
       "      <td>4</td>\n",
       "      <td>sedan</td>\n",
       "      <td>fwd</td>\n",
       "      <td>front</td>\n",
       "      <td>99.8</td>\n",
       "      <td>176.6</td>\n",
       "      <td>...</td>\n",
       "      <td>109</td>\n",
       "      <td>mpfi</td>\n",
       "      <td>3.19</td>\n",
       "      <td>3.40</td>\n",
       "      <td>10</td>\n",
       "      <td>102</td>\n",
       "      <td>5500</td>\n",
       "      <td>24</td>\n",
       "      <td>30</td>\n",
       "      <td>13950</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2</td>\n",
       "      <td>audi</td>\n",
       "      <td>gas</td>\n",
       "      <td>std</td>\n",
       "      <td>4</td>\n",
       "      <td>sedan</td>\n",
       "      <td>4wd</td>\n",
       "      <td>front</td>\n",
       "      <td>99.4</td>\n",
       "      <td>176.6</td>\n",
       "      <td>...</td>\n",
       "      <td>136</td>\n",
       "      <td>mpfi</td>\n",
       "      <td>3.19</td>\n",
       "      <td>3.40</td>\n",
       "      <td>8</td>\n",
       "      <td>115</td>\n",
       "      <td>5500</td>\n",
       "      <td>18</td>\n",
       "      <td>22</td>\n",
       "      <td>17450</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows Ã— 25 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   symboling         make fuel_type aspiration  num_of_doors   body_style  \\\n",
       "0          3  alfa-romero       gas        std             2  convertible   \n",
       "1          3  alfa-romero       gas        std             2  convertible   \n",
       "2          1  alfa-romero       gas        std             2    hatchback   \n",
       "3          2         audi       gas        std             4        sedan   \n",
       "4          2         audi       gas        std             4        sedan   \n",
       "\n",
       "  drive_wheels engine_location  wheel_base  length  ...  engine_size  \\\n",
       "0          rwd           front        88.6   168.8  ...          130   \n",
       "1          rwd           front        88.6   168.8  ...          130   \n",
       "2          rwd           front        94.5   171.2  ...          152   \n",
       "3          fwd           front        99.8   176.6  ...          109   \n",
       "4          4wd           front        99.4   176.6  ...          136   \n",
       "\n",
       "   fuel_system  bore stroke  compression_ratio  horsepower peak_rpm  city_mpg  \\\n",
       "0         mpfi  3.47   2.68                  9         111     5000        21   \n",
       "1         mpfi  3.47   2.68                  9         111     5000        21   \n",
       "2         mpfi  2.68   3.47                  9         154     5000        19   \n",
       "3         mpfi  3.19   3.40                 10         102     5500        24   \n",
       "4         mpfi  3.19   3.40                  8         115     5500        18   \n",
       "\n",
       "   highway_mpg  price  \n",
       "0           27  13495  \n",
       "1           27  16500  \n",
       "2           26  16500  \n",
       "3           30  13950  \n",
       "4           22  17450  \n",
       "\n",
       "[5 rows x 25 columns]"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "autos.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "429a6780",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.575522Z",
     "iopub.status.busy": "2024-10-24T22:31:18.575048Z",
     "iopub.status.idle": "2024-10-24T22:31:18.602165Z",
     "shell.execute_reply": "2024-10-24T22:31:18.600978Z"
    },
    "papermill": {
     "duration": 0.040719,
     "end_time": "2024-10-24T22:31:18.605580",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.564861",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 193 entries, 0 to 192\n",
      "Data columns (total 25 columns):\n",
      " #   Column             Non-Null Count  Dtype  \n",
      "---  ------             --------------  -----  \n",
      " 0   symboling          193 non-null    int64  \n",
      " 1   make               193 non-null    object \n",
      " 2   fuel_type          193 non-null    object \n",
      " 3   aspiration         193 non-null    object \n",
      " 4   num_of_doors       193 non-null    int64  \n",
      " 5   body_style         193 non-null    object \n",
      " 6   drive_wheels       193 non-null    object \n",
      " 7   engine_location    193 non-null    object \n",
      " 8   wheel_base         193 non-null    float64\n",
      " 9   length             193 non-null    float64\n",
      " 10  width              193 non-null    float64\n",
      " 11  height             193 non-null    float64\n",
      " 12  curb_weight        193 non-null    int64  \n",
      " 13  engine_type        193 non-null    object \n",
      " 14  num_of_cylinders   193 non-null    int64  \n",
      " 15  engine_size        193 non-null    int64  \n",
      " 16  fuel_system        193 non-null    object \n",
      " 17  bore               193 non-null    float64\n",
      " 18  stroke             193 non-null    float64\n",
      " 19  compression_ratio  193 non-null    int64  \n",
      " 20  horsepower         193 non-null    int64  \n",
      " 21  peak_rpm           193 non-null    int64  \n",
      " 22  city_mpg           193 non-null    int64  \n",
      " 23  highway_mpg        193 non-null    int64  \n",
      " 24  price              193 non-null    int64  \n",
      "dtypes: float64(6), int64(11), object(8)\n",
      "memory usage: 37.8+ KB\n"
     ]
    }
   ],
   "source": [
    "autos.info()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "2207d3cb",
   "metadata": {
    "lines_to_next_cell": 0,
    "papermill": {
     "duration": 0.007173,
     "end_time": "2024-10-24T22:31:18.620273",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.613100",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# Target Encoding #\n",
    "\n",
    "A **target encoding** is any kind of encoding that replaces a feature's categories with some number derived from the target.\n",
    "\n",
    "A simple and effective version is to apply a group aggregation from Lesson 3, like the mean. Using the *Automobiles* dataset, this computes the average price of each vehicle's make:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "87a76ecf",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.639107Z",
     "iopub.status.busy": "2024-10-24T22:31:18.638642Z",
     "iopub.status.idle": "2024-10-24T22:31:18.651277Z",
     "shell.execute_reply": "2024-10-24T22:31:18.649798Z"
    },
    "papermill": {
     "duration": 0.02553,
     "end_time": "2024-10-24T22:31:18.653879",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.628349",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "make\n",
       "toyota           31\n",
       "nissan           17\n",
       "subaru           12\n",
       "mazda            12\n",
       "mitsubishi       12\n",
       "honda            12\n",
       "volkswagen       12\n",
       "peugot           11\n",
       "volvo            11\n",
       "dodge             8\n",
       "bmw               8\n",
       "mercedes-benz     8\n",
       "plymouth          7\n",
       "audi              6\n",
       "saab              6\n",
       "porsche           4\n",
       "jaguar            3\n",
       "chevrolet         3\n",
       "alfa-romero       2\n",
       "isuzu             2\n",
       "mercury           1\n",
       "Name: price, dtype: int64"
      ]
     },
     "execution_count": 4,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "autos.groupby('make')['price'].nunique().sort_values(ascending=False)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "85968eb7",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.671286Z",
     "iopub.status.busy": "2024-10-24T22:31:18.670868Z",
     "iopub.status.idle": "2024-10-24T22:31:18.696592Z",
     "shell.execute_reply": "2024-10-24T22:31:18.695022Z"
    },
    "papermill": {
     "duration": 0.038328,
     "end_time": "2024-10-24T22:31:18.699895",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.661567",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>make</th>\n",
       "      <th>price</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>66</th>\n",
       "      <td>mercury</td>\n",
       "      <td>16503</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       make  price\n",
       "66  mercury  16503"
      ]
     },
     "execution_count": 5,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "autos.query('make == \"mercury\"')[['make', 'price']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "91113a12",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.719741Z",
     "iopub.status.busy": "2024-10-24T22:31:18.719244Z",
     "iopub.status.idle": "2024-10-24T22:31:18.742074Z",
     "shell.execute_reply": "2024-10-24T22:31:18.740331Z"
    },
    "papermill": {
     "duration": 0.035898,
     "end_time": "2024-10-24T22:31:18.745291",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.709393",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>make</th>\n",
       "      <th>price</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>audi</td>\n",
       "      <td>13950</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>audi</td>\n",
       "      <td>17450</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>audi</td>\n",
       "      <td>15250</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>audi</td>\n",
       "      <td>17710</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>audi</td>\n",
       "      <td>18920</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>audi</td>\n",
       "      <td>23875</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   make  price\n",
       "3  audi  13950\n",
       "4  audi  17450\n",
       "5  audi  15250\n",
       "6  audi  17710\n",
       "7  audi  18920\n",
       "8  audi  23875"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "autos.query('make == \"audi\"')[['make', 'price']]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "73e8ca59",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.765047Z",
     "iopub.status.busy": "2024-10-24T22:31:18.764511Z",
     "iopub.status.idle": "2024-10-24T22:31:18.794591Z",
     "shell.execute_reply": "2024-10-24T22:31:18.793248Z"
    },
    "papermill": {
     "duration": 0.043837,
     "end_time": "2024-10-24T22:31:18.797932",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.754095",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>make</th>\n",
       "      <th>price</th>\n",
       "      <th>make_encoded</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>138</th>\n",
       "      <td>toyota</td>\n",
       "      <td>5348</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>139</th>\n",
       "      <td>toyota</td>\n",
       "      <td>6338</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>140</th>\n",
       "      <td>toyota</td>\n",
       "      <td>6488</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>141</th>\n",
       "      <td>toyota</td>\n",
       "      <td>6918</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>142</th>\n",
       "      <td>toyota</td>\n",
       "      <td>7898</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>143</th>\n",
       "      <td>toyota</td>\n",
       "      <td>8778</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>144</th>\n",
       "      <td>toyota</td>\n",
       "      <td>6938</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>145</th>\n",
       "      <td>toyota</td>\n",
       "      <td>7198</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>146</th>\n",
       "      <td>toyota</td>\n",
       "      <td>7898</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>147</th>\n",
       "      <td>toyota</td>\n",
       "      <td>7788</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>148</th>\n",
       "      <td>toyota</td>\n",
       "      <td>7738</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>149</th>\n",
       "      <td>toyota</td>\n",
       "      <td>8358</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>150</th>\n",
       "      <td>toyota</td>\n",
       "      <td>9258</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>151</th>\n",
       "      <td>toyota</td>\n",
       "      <td>8058</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>152</th>\n",
       "      <td>toyota</td>\n",
       "      <td>8238</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>153</th>\n",
       "      <td>toyota</td>\n",
       "      <td>9298</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>154</th>\n",
       "      <td>toyota</td>\n",
       "      <td>9538</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>155</th>\n",
       "      <td>toyota</td>\n",
       "      <td>8449</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>156</th>\n",
       "      <td>toyota</td>\n",
       "      <td>9639</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>157</th>\n",
       "      <td>toyota</td>\n",
       "      <td>9989</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>158</th>\n",
       "      <td>toyota</td>\n",
       "      <td>11199</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>159</th>\n",
       "      <td>toyota</td>\n",
       "      <td>11549</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>160</th>\n",
       "      <td>toyota</td>\n",
       "      <td>17669</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>161</th>\n",
       "      <td>toyota</td>\n",
       "      <td>8948</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>162</th>\n",
       "      <td>toyota</td>\n",
       "      <td>10698</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>163</th>\n",
       "      <td>toyota</td>\n",
       "      <td>9988</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>164</th>\n",
       "      <td>toyota</td>\n",
       "      <td>10898</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>165</th>\n",
       "      <td>toyota</td>\n",
       "      <td>11248</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>166</th>\n",
       "      <td>toyota</td>\n",
       "      <td>16558</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>167</th>\n",
       "      <td>toyota</td>\n",
       "      <td>15998</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>168</th>\n",
       "      <td>toyota</td>\n",
       "      <td>15690</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>169</th>\n",
       "      <td>toyota</td>\n",
       "      <td>15750</td>\n",
       "      <td>9885.8125</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       make  price  make_encoded\n",
       "138  toyota   5348     9885.8125\n",
       "139  toyota   6338     9885.8125\n",
       "140  toyota   6488     9885.8125\n",
       "141  toyota   6918     9885.8125\n",
       "142  toyota   7898     9885.8125\n",
       "143  toyota   8778     9885.8125\n",
       "144  toyota   6938     9885.8125\n",
       "145  toyota   7198     9885.8125\n",
       "146  toyota   7898     9885.8125\n",
       "147  toyota   7788     9885.8125\n",
       "148  toyota   7738     9885.8125\n",
       "149  toyota   8358     9885.8125\n",
       "150  toyota   9258     9885.8125\n",
       "151  toyota   8058     9885.8125\n",
       "152  toyota   8238     9885.8125\n",
       "153  toyota   9298     9885.8125\n",
       "154  toyota   9538     9885.8125\n",
       "155  toyota   8449     9885.8125\n",
       "156  toyota   9639     9885.8125\n",
       "157  toyota   9989     9885.8125\n",
       "158  toyota  11199     9885.8125\n",
       "159  toyota  11549     9885.8125\n",
       "160  toyota  17669     9885.8125\n",
       "161  toyota   8948     9885.8125\n",
       "162  toyota  10698     9885.8125\n",
       "163  toyota   9988     9885.8125\n",
       "164  toyota  10898     9885.8125\n",
       "165  toyota  11248     9885.8125\n",
       "166  toyota  16558     9885.8125\n",
       "167  toyota  15998     9885.8125\n",
       "168  toyota  15690     9885.8125\n",
       "169  toyota  15750     9885.8125"
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "autos[\"make_encoded\"] = autos.groupby(\"make\")[\"price\"].transform(\"mean\")\n",
    "\n",
    "autos[[\"make\", \"price\", \"make_encoded\"]].query('make == \"toyota\"')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "76417aab",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.818133Z",
     "iopub.status.busy": "2024-10-24T22:31:18.817634Z",
     "iopub.status.idle": "2024-10-24T22:31:18.847808Z",
     "shell.execute_reply": "2024-10-24T22:31:18.845039Z"
    },
    "papermill": {
     "duration": 0.044154,
     "end_time": "2024-10-24T22:31:18.851376",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.807222",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>make</th>\n",
       "      <th>price</th>\n",
       "      <th>make_encoded</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>audi</td>\n",
       "      <td>13950</td>\n",
       "      <td>17859.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>audi</td>\n",
       "      <td>17450</td>\n",
       "      <td>17859.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>audi</td>\n",
       "      <td>15250</td>\n",
       "      <td>17859.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>audi</td>\n",
       "      <td>17710</td>\n",
       "      <td>17859.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>audi</td>\n",
       "      <td>18920</td>\n",
       "      <td>17859.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>audi</td>\n",
       "      <td>23875</td>\n",
       "      <td>17859.166667</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>66</th>\n",
       "      <td>mercury</td>\n",
       "      <td>16503</td>\n",
       "      <td>16503.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "       make  price  make_encoded\n",
       "3      audi  13950  17859.166667\n",
       "4      audi  17450  17859.166667\n",
       "5      audi  15250  17859.166667\n",
       "6      audi  17710  17859.166667\n",
       "7      audi  18920  17859.166667\n",
       "8      audi  23875  17859.166667\n",
       "66  mercury  16503  16503.000000"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "autos[[\"make\", \"price\", \"make_encoded\"]].query('make == \"audi\" | make == \"mercury\"')"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "881f4226",
   "metadata": {
    "papermill": {
     "duration": 0.010288,
     "end_time": "2024-10-24T22:31:18.873490",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.863202",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "This kind of target encoding is sometimes called a **mean encoding**. Applied to a binary target, it's also called **bin counting**. (Other names you might come across include: likelihood encoding, impact encoding, and leave-one-out encoding.)\n",
    "\n",
    "# Smoothing #\n",
    "\n",
    "An encoding like this presents a couple of problems, however. First are *unknown categories*. Target encodings create a special risk of overfitting, which means they need to be trained on an independent \"encoding\" split. When you join the encoding to future splits, Pandas will fill in missing values for any categories not present in the encoding split. These missing values you would have to impute somehow.\n",
    "\n",
    "Second are *rare categories*. When a category only occurs a few times in the dataset, any statistics calculated on its group are unlikely to be very accurate. In the *Automobiles* dataset, the `mercurcy` make only occurs once. The \"mean\" price we calculated is just the price of that one vehicle, which might not be very representative of any Mercuries we might see in the future. Target encoding rare categories can make overfitting more likely.\n",
    "\n",
    "A solution to these problems is to add **smoothing**. The idea is to blend the *in-category* average with the *overall* average. Rare categories get less weight on their category average, while missing categories just get the overall average.\n",
    "\n",
    "In pseudocode:\n",
    "```\n",
    "encoding = weight * in_category + (1 - weight) * overall\n",
    "```\n",
    "where `weight` is a value between 0 and 1 calculated from the category frequency.\n",
    "\n",
    "An easy way to determine the value for `weight` is to compute an **m-estimate**:\n",
    "```\n",
    "weight = n / (n + m)\n",
    "```\n",
    "where `n` is the total number of times that category occurs in the data. The parameter `m` determines the \"smoothing factor\". Larger values of `m` put more weight on the overall estimate.\n",
    "\n",
    "<figure style=\"padding: 1em;\">\n",
    "<img src=\"https://storage.googleapis.com/kaggle-media/learn/images/1uVtQEz.png\" width=500, alt=\"\">\n",
    "<figcaption style=\"textalign: center; font-style: italic\"><center>\n",
    "</center></figcaption>\n",
    "</figure>\n",
    "\n",
    "In the *Automobiles* dataset there are three cars with the make `chevrolet`. If you chose `m=2.0`, then the `chevrolet` category would be encoded with 60% of the average Chevrolet price plus 40% of the overall average price.\n",
    "```\n",
    "chevrolet = 0.6 * 6000.00 + 0.4 * 13285.03\n",
    "```\n",
    "\n",
    "When choosing a value for `m`, consider how noisy you expect the categories to be. Does the price of a vehicle vary a great deal within each make? Would you need a lot of data to get good estimates? If so, it could be better to choose a larger value for `m`; if the average price for each make were relatively stable, a smaller value could be okay.\n",
    "\n",
    "<blockquote style=\"margin-right:auto; margin-left:auto; background-color: #ebf9ff; padding: 1em; margin:24px;\">\n",
    "<strong>Use Cases for Target Encoding</strong><br>\n",
    "Target encoding is great for:\n",
    "<ul>\n",
    "<li><strong>High-cardinality features</strong>: A feature with a large number of categories can be troublesome to encode: a one-hot encoding would generate too many features and alternatives, like a label encoding, might not be appropriate for that feature. A target encoding derives numbers for the categories using the feature's most important property: its relationship with the target.\n",
    "<li><strong>Domain-motivated features</strong>: From prior experience, you might suspect that a categorical feature should be important even if it scored poorly with a feature metric. A target encoding can help reveal a feature's true informativeness.\n",
    "</ul>\n",
    "</blockquote>\n",
    "\n",
    "# Example - MovieLens1M #\n",
    "\n",
    "The [*MovieLens1M*](https://www.kaggle.com/grouplens/movielens-20m-dataset) dataset contains one-million movie ratings by users of the MovieLens website, with features describing each user and movie. This hidden cell sets everything up:"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "bc07001d",
   "metadata": {
    "_kg_hide-input": true,
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:18.899993Z",
     "iopub.status.busy": "2024-10-24T22:31:18.898467Z",
     "iopub.status.idle": "2024-10-24T22:31:25.946428Z",
     "shell.execute_reply": "2024-10-24T22:31:25.944454Z"
    },
    "papermill": {
     "duration": 7.065498,
     "end_time": "2024-10-24T22:31:25.949665",
     "exception": false,
     "start_time": "2024-10-24T22:31:18.884167",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_18/1532777590.py:7: MatplotlibDeprecationWarning: The seaborn styles shipped by Matplotlib are deprecated since 3.6, as they no longer correspond to the styles shipped by seaborn. However, they will remain available as 'seaborn-v0_8-<style>'. Alternatively, directly use the seaborn API instead.\n",
      "  plt.style.use(\"seaborn-whitegrid\")\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of Unique Zipcodes: 3439\n"
     ]
    }
   ],
   "source": [
    "\n",
    "import matplotlib.pyplot as plt\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import seaborn as sns\n",
    "import warnings\n",
    "\n",
    "plt.style.use(\"seaborn-whitegrid\")\n",
    "plt.rc(\"figure\", autolayout=True)\n",
    "plt.rc(\n",
    "    \"axes\",\n",
    "    labelweight=\"bold\",\n",
    "    labelsize=\"large\",\n",
    "    titleweight=\"bold\",\n",
    "    titlesize=14,\n",
    "    titlepad=10,\n",
    ")\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "\n",
    "df = pd.read_csv(\"../input/fe-course-data/movielens1m.csv\")\n",
    "df = df.astype(np.uint8, errors='ignore') # reduce memory footprint\n",
    "print(\"Number of Unique Zipcodes: {}\".format(df[\"Zipcode\"].nunique()))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eff2c9f5",
   "metadata": {
    "papermill": {
     "duration": 0.008635,
     "end_time": "2024-10-24T22:31:25.967251",
     "exception": false,
     "start_time": "2024-10-24T22:31:25.958616",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "With over 3000 categories, the `Zipcode` feature makes a good candidate for target encoding, and the size of this dataset (over one-million rows) means we can spare some data to create the encoding.\n",
    "\n",
    "We'll start by creating a 25% split to train the target encoder."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "0183722c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:25.988192Z",
     "iopub.status.busy": "2024-10-24T22:31:25.987065Z",
     "iopub.status.idle": "2024-10-24T22:31:26.408623Z",
     "shell.execute_reply": "2024-10-24T22:31:26.407443Z"
    },
    "papermill": {
     "duration": 0.43534,
     "end_time": "2024-10-24T22:31:26.411710",
     "exception": false,
     "start_time": "2024-10-24T22:31:25.976370",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "X = df.copy()\n",
    "y = X.pop('Rating')\n",
    "\n",
    "X_encode = X.sample(frac=0.25)\n",
    "y_encode = y[X_encode.index]\n",
    "X_pretrain = X.drop(X_encode.index)\n",
    "y_train = y[X_pretrain.index]"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "51745251",
   "metadata": {
    "papermill": {
     "duration": 0.008342,
     "end_time": "2024-10-24T22:31:26.428986",
     "exception": false,
     "start_time": "2024-10-24T22:31:26.420644",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "The `category_encoders` package in `scikit-learn-contrib` implements an m-estimate encoder, which we'll use to encode our `Zipcode` feature."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "d93f724e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:26.448411Z",
     "iopub.status.busy": "2024-10-24T22:31:26.447938Z",
     "iopub.status.idle": "2024-10-24T22:31:28.277274Z",
     "shell.execute_reply": "2024-10-24T22:31:28.275403Z"
    },
    "papermill": {
     "duration": 1.843508,
     "end_time": "2024-10-24T22:31:28.281195",
     "exception": false,
     "start_time": "2024-10-24T22:31:26.437687",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "from category_encoders import MEstimateEncoder\n",
    "\n",
    "# Create the encoder instance. Choose m to control noise.\n",
    "encoder = MEstimateEncoder(cols=[\"Zipcode\"], m=5.0)\n",
    "\n",
    "# Fit the encoder on the encoding split.\n",
    "encoder.fit(X_encode, y_encode)\n",
    "\n",
    "# Encode the Zipcode column to create the final training data\n",
    "X_train = encoder.transform(X_pretrain)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "366f18c0",
   "metadata": {
    "papermill": {
     "duration": 0.008841,
     "end_time": "2024-10-24T22:31:28.299071",
     "exception": false,
     "start_time": "2024-10-24T22:31:28.290230",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "Let's compare the encoded values to the target to see how informative our encoding might be."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "99011479",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2024-10-24T22:31:28.319884Z",
     "iopub.status.busy": "2024-10-24T22:31:28.319063Z",
     "iopub.status.idle": "2024-10-24T22:31:33.072685Z",
     "shell.execute_reply": "2024-10-24T22:31:33.071209Z"
    },
    "papermill": {
     "duration": 4.76735,
     "end_time": "2024-10-24T22:31:33.075514",
     "exception": false,
     "start_time": "2024-10-24T22:31:28.308164",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "data": {
      "image/png": "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PSby1pA8qAQ3wp3+k+hDXF/NmjUVHByc7X5bT0tdqWrVqqpRo4aGDx+umTNnZtp/vYbkRFRUlOrWrZsr753fFJS2FpR2SgWrrav3r1PlSpWveUzdupXyqJrc49Q+jU4+mGlbzMGYTH3qhD7MilP7NSu51VZ3BzxsPy11peTkZObcAACAHLEt3MTFxWnRokU6f/68LMtSdHS0pk6dqiZNmthVEgAAcADbTku5XC6tWLFC77zzjhITE1WqVClFRkZq0KBBdpUEAAAcwLZwExISoo8//tiujwcAAA6Vr+bcAAAA5BThBgAAOArhBgAAOArhBgAAOArhBgAAOArhBgAAOArhBgAAOArhBgAAOEq+uXEmAADI3+Zuynzz06yE2ZwuGLkBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACOQrgBAACO4nG4SUlJyY06AAAAvMLjcNO0aVO99dZb2rlzZ27UAwAAkCMeh5szZ85ozpw5euyxx9S6dWtNnz5dx48fz43aAAAAPOZxuGndurWKFCkiy7K0b98+jR8/Xi1atFD37t21ZMkSxcXF5UadAAAAbvE43IwbN04bNmzQBx98oA4dOqhEiRJKTU3V5s2b9be//U1NmjTRyy+/rP/+97+5US8AAMA13dDVUoGBgWrevLnefvttffbZZ7r77rtlWZYk6dKlS1qyZInat2+vVatWebVYAACA6wm4kW+Kj4/XqlWrtGjRIkVFRaUHG5fLpebNm+vs2bPavn27xo8frwceeMCrBQMAAFyLx+Fm5MiRWrlypeLi4tJDTZkyZdSxY0d16tRJFSpUUEpKiu655x4dPnzY6wUDAABci8fhZsGCBemv69evr86dOysyMlIBAZffyt/fX2FhYTp06JB3qgQAAHCTx+GmWLFiateunZ544glVrVo12+NmzZqVo8IAAABuhMfhZuzYsQoJCcky2KSmpkqS/Py4qwMAALCHx+Hmueeek5+fn3799ddM++64445s9wEAAOSFGxpiSZtIfKXk5ORs9wEAAOQVt0ZuNm/erM2bN2fY9v7772f4+sCBA5KkQoUKeak0AAAAz7kdbiZPnpz+tWVZGb5O43K5VK1aNe9VBwAA4CG359xcuVDflV9f6ZZbbtErr7zipdIAAAA8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c3rooYckSQ8//LD69OljZ0kAAMDH2TahOK/MmTNHixcv1p49e9SsWTNNmTIl22MvXLig1157TWvWrFGhQoX05JNPqn///nlYbc540tZu3bpp27ZtCgwMTN+2atUqlStXLi9KzZHExESNGjVKP/zwg86ePaty5crp2WefzXbUz5f71dO2+nK/StLo0aP1zTffKDY2VkWKFNEDDzygF198UUFBQZmO9eV+9aSdvt6naeLj49W2bVudPXtWW7ZsyfIYX+7TNO6009f7dPjw4VqxYkWG+mfMmKHwK2/fcgU7Fux1/FLAoaGh6tevn3744QcdP378mseOHj1a586d0/fff6/ff/9dTz/9tCpWrKh27drlTbE55ElbJWnYsGHq0aNH7hfmZcnJySpbtqxmzpypm2++Wdu3b1evXr1Uvnx5NWnSJNPxvtyvnrZV8t1+laQuXbpo6NChCgkJ0ZkzZzR48GB99NFH6tevX6ZjfblfPWmn5Nt9mmbixImqUKGCzp49m+0xvtynadxpp+T7fdq5c2eNGDHCrWPtWLDX1jk3eSEyMlItW7ZUyZIlr3ncpUuX9OWXX+r5559X8eLFVaVKFXXt2lULFy7Mo0pzzt22+rqQkBANHjxYlSpVksvlUp06dRQREaGoqKhMx/p6v3rSVieoWrVq+pWUkrmgICYmJtNxvt6v7rbTKXbu3Kn169erV69e2R7j630qudfOgmjRokXq27evQkNDFRoaqj59+mjRokW5+pmODzfuOnDggJKSkjItKhgdHW1jVblr6tSpatCggdq1a6cvvvjC7nJuWEJCgn7++WeFZbFoltP69VptTePr/Tp9+nSFh4erUaNG2r17t7p27ZrpGCf0qzvtTOPLfZqcnKyRI0fq1VdfzXAa42q+3qfutjONL/epJC1dulQNGjRQ69atNWPGDKWmpmZ53PUW7M0tjj8t5a6LFy8qJCQkwznAYsWKKS4uzsaqcs8LL7yg2267TYUKFdLGjRv1/PPPq0iRImp15Y0TfYBlWRoxYoQqV66syMjITPud1K/Xa6vkjH7t3bu3evfurX379mnZsmUqW7ZspmOc0K/utFPy/T795z//qdtvv13169fXpk2bsj3O1/vU3XZKvt+n3bp100svvaQSJUpox44dev755+Xn55flabaLFy9KUoYlXYoXLy5JiouLy7WlXhi5+Z+Q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",
      "text/plain": [
       "<Figure size 576x432 with 1 Axes>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "plt.figure(dpi=90)\n",
    "ax = sns.distplot(y, kde=False, norm_hist=True)\n",
    "ax = sns.kdeplot(X_train.Zipcode, color='r', ax=ax)\n",
    "ax.set_xlabel(\"Rating\")\n",
    "ax.legend(labels=['Zipcode', 'Rating']);"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "8de99c6b",
   "metadata": {
    "papermill": {
     "duration": 0.008961,
     "end_time": "2024-10-24T22:31:33.093808",
     "exception": false,
     "start_time": "2024-10-24T22:31:33.084847",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "The distribution of the encoded `Zipcode` feature roughly follows the distribution of the actual ratings, meaning that movie-watchers differed enough in their ratings from zipcode to zipcode that our target encoding was able to capture useful information.\n",
    "\n",
    "# Your Turn #\n",
    "\n",
    "[**Apply target encoding**](https://www.kaggle.com/kernels/fork/14393917) to features in *Ames* and investigate a surprising way that target encoding can lead to overfitting."
   ]
  },
  {
   "cell_type": "markdown",
   "id": "b60669cd",
   "metadata": {
    "papermill": {
     "duration": 0.009262,
     "end_time": "2024-10-24T22:31:33.112281",
     "exception": false,
     "start_time": "2024-10-24T22:31:33.103019",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "---\n",
    "\n",
    "\n",
    "\n",
    "\n",
    "*Have questions or comments? Visit the [course discussion forum](https://www.kaggle.com/learn/feature-engineering/discussion) to chat with other learners.*"
   ]
  }
 ],
 "metadata": {
  "jupytext": {
   "cell_metadata_filter": "-all",
   "formats": "ipynb"
  },
  "kaggle": {
   "accelerator": "none",
   "dataSources": [
    {
     "datasetId": 933090,
     "sourceId": 1828856,
     "sourceType": "datasetVersion"
    }
   ],
   "isGpuEnabled": false,
   "isInternetEnabled": false,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.14"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 20.479927,
   "end_time": "2024-10-24T22:31:34.249143",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2024-10-24T22:31:13.769216",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
